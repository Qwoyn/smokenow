$(function(){var p="penguinpablo",a="api.steemit.com",r="light";!function(){s("myaccount")&&(p=s("myaccount"));s("node")&&"api.steemit.com"!=(a=s("node"))&&"steemd.steemit.com"!=a&&$("select[name='frm_node']").val(a);s("theme")&&"dark"==(r=s("theme"))&&($("#themecss").attr("href","style_dark.css?v=928"),$("select[name='frm_theme']").val(r));$("input[name='frm_username']").val(p),s("filter_section")&&($("select[name='frm_filter_section']").val(s("filter_section")),$("input[name='frm_filter_minrep']").val(s("filter_minrep")),$("select[name='frm_filter_payoutlg']").val(s("filter_payoutlg")),$("input[name='frm_filter_payout']").val(s("filter_payout")))}();var n,m,g,d,e=window.location.pathname.match(/^\/@([0-z-\.]{3,16})/);e&&(p=e[1],$("input[name='frm_username']").val(p)),"steemd.steemit.com"==a&&(a="api.steemit.com"),"api.steemit.com"==a||steem.api.setOptions({url:"https://"+a});var f=432e3,h=1e4,_={curation:0,author:0},v={curation:0,author:0},t=new Date,o=new Date;o.setDate(o.getDate()-1),o.setHours(0,0,0,0);var y=[];for(i=0;i<48&&o<t;i++)y[o.getDate()+"_"+o.getHours()+":00"]=0,o.setHours(o.getHours()+1);var w;function b(e,t){var a=new Date;a.setTime(a.getTime()+31536e6),document.cookie=e+"="+t+";expires="+a.toUTCString()}function s(e){var t=document.cookie.match("(^|;) ?"+e+"=([^;]*)(;|$)");return t?t[2]:null}function x(e){return new Date(e+"Z")}function S(e,t){if(null==e)return e;e=parseInt(e);var a=String(e),r="-"===a.charAt(0),n=a=r?a.substring(1):a,o=parseInt(n.substring(0,4)),i=Math.log(o)/Math.log(10),s=n.length-1+(i-parseInt(i));return isNaN(s)&&(s=0),s=Math.max(s-9,0),s=9*(s*=r?-1:1)+25,s=Math.floor(s*Math.pow(10,t))/Math.pow(10,t)}function D(e,t,a){var r=t.replace(" VESTS","")*m,n=a.replace(" VESTS","")*m,o=e.replace(" VESTS","")*m+r-n;return o=o.toFixed(3).replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")}function k(e){$(e).hide().fadeIn(800)}function l(e,t,a,r,n){var o=new Date,i=new Date;i.setDate(o.getDate()-1);var s=x(n),l=t[2].replace(" VESTS",""),c=l*m;if(c=c.toFixed(3)+" SP",s.getDate()==o.getDate()?_[e]+=parseFloat(l):s.getDate()==i.getDate()&&(v[e]+=parseFloat(l)),"curation"==e){var u=s.getDate()+"_"+s.getHours()+":00";u in y||s.getDate()!=o.getDate()||(y[u]=0),0<=y[u]&&(y[u]+=parseFloat(c.replace(" SP","")),y[u]=Math.round(1e3*y[u])/1e3),$("#rewards_curation_today").text((_[e]*m).toFixed(3)),$("#rewards_curation_yesterday").text((v[e]*m).toFixed(3)),$("#latestcurrewards").prepend("<li><time class='timeago' datetime='"+n+"Z' title='"+s.toLocaleTimeString()+"'></time>"+c+" for <a href='https://steemblockexplorer.com/@"+a+"/"+r+"' target='_blank'>@"+a+"/"+r+"</a></i></li>"),$("#latestcurrewards li").slice(25).remove(),k($("#latestcurrewards li:first"))}"author"==e&&($("#rewards_author_today").text((_[e]*m).toFixed(3)),$("#rewards_author_yesterday").text((v[e]*m).toFixed(3)),$("#latestauthrewards").prepend("<li><time class='timeago' datetime='"+n+"Z' title='"+s.toLocaleTimeString()+"'></time>"+t[0]+", "+t[1]+", "+c+" for <a href='https://steemblockexplorer.com/@"+a+"/"+r+"' target='_blank'>/"+r+"</a></i></li>"),$("#latestauthrewards li").slice(25).remove(),k($("#latestauthrewards li:first")))}function T(){clearTimeout(w),steem.api.getAccounts([p],function(e,t){if(""!=t){$("#username").text(p),$("#reputation").text(S(t[0].reputation,3)),$("#balance").text(t[0].balance),$("#sbd_balance").text(t[0].sbd_balance);var a=D(t[0].vesting_shares,t[0].received_vesting_shares,t[0].delegated_vesting_shares);$("#vesting_shares").text(a+" SP");var r=t[0].voting_power,n=(new Date-x(t[0].last_vote_time))/1e3;if(r=100<(r=(r+h*n/f)/100)?100:r.toFixed(2),$("#myvotingpower").css("width",r+"%"),100==r)$("#myvotingpower").html("voting power: "+r+"%");else{var o=new Date;o.setSeconds(o.getSeconds()+parseInt((100-r)/100*f));var i=Math.abs(o-new Date)/36e5;if(220<parseInt($("#myvotingpower").css("width"))){if(i<1)var s=Math.round(60*i)+" minutes";else{s=Math.round(i)+" hour";2<=Math.round(i)&&(s+="s")}$("#myvotingpower").html("voting power: "+r+"%, full in <time title='100% Voting Power on "+o.toLocaleString()+"'>"+s+"</time>")}else{if(i<1)s=Math.round(60*i)+"m";else s=Math.round(i)+"h";$("#myvotingpower").html(r+"%, <time title='100% Voting Power on "+o.toLocaleString()+"'>"+s+"</time>")}}var l=parseInt(100*r*(100*$("#vote_weight").text())/h);l=parseInt((l+49)/50);var c=parseInt((parseInt(t[0].vesting_shares.replace(" VESTS",""))+parseInt(t[0].received_vesting_shares.replace(" VESTS",""))-parseInt(t[0].delegated_vesting_shares.replace(" VESTS","")))*l*100)*g*d;$("#vote_value").text(c.toFixed(2)),w=setTimeout(T,4e4)}else{var u="Username '"+p+"' doesn't exist...";$("#latestvotes li:first").text(u),$("#latestcurrewards li:first").text(u),$("#latestauthrewards li:first").text(u),b("myaccount","penguinpablo")}})}timeago.register("en_short",function(e,t,a){return[["just now","right now"],["%ss ago","in %ss"],["1m ago","in 1m"],["%sm ago","in %sm"],["1h ago","in 1h"],["%sh ago","in %sh"],["1d ago","in 1d"],["%sd ago","in %sd"],["1w ago","in 1w"],["%sw ago","in %sw"],["1mo ago","in 1mo"],["%smo ago","in %smo"],["1yr ago","in 1yr"],["%syr ago","in %syr"]][t]}),$(document).on("click",".linkaccount",function(e){var n=$(this).attr("data-account");return $("#accountinfo").show(),$("#accountinfo").css({top:e.pageY-122,left:e.pageX+8}),$("#accountinfo > .header").text("@"+n),$("#accountinfo > span").text("Loading..."),steem.api.getAccounts([n],function(e,t){if(""!=t){var a=Math.round(t[0].voting_power/100);$("#accountinfo > .header").text("@"+t[0].name+" - "+S(t[0].reputation,1)),$("#accountinfo > span").html("Vests: "+(t[0].vesting_shares.replace(" VESTS","")/1e6).toFixed(1)+"M");var r=parseInt(t[0].received_vesting_shares.replace(" VESTS",""));1e5<r&&$("#accountinfo > span").append(" <i>+ "+(r/1e6).toFixed(1)+"M</i>"),$("#accountinfo > span").append("<br>Steem Power: "+D(t[0].vesting_shares,t[0].received_vesting_shares,t[0].delegated_vesting_shares)+'<div class="votingpowerback"><div class="votingpower" style="width:'+a+'%">'+a+'%</div></div><a href="https://steemit.com/@'+n+'" target="_blank" style="color:white;margin-left:50px">- Steemit.com -</a>')}}),!1}),$(document).on("click",function(){$("#accountinfo").hide()}),function o(){$.ajax({dataType:"json",url:"https://api.steemit.com",method:"POST",data:'{"jsonrpc":"2.0", "method":"rc_api.find_rc_accounts", "params":{"accounts": ["'+p+'"]}, "id":1}'}).done(function(e){var t=Math.round((new Date).getTime()/1e3)-e.result.rc_accounts[0].rc_manabar.last_update_time,a=parseInt(e.result.rc_accounts[0].max_rc),r=parseInt(e.result.rc_accounts[0].rc_manabar.current_mana)+Math.round(a/432e3*t),n=100;r<a?n=(n=r/a*100).toFixed(2):r=a,$("#rcpower").css("width",n+"%"),$("#rcpower").html("RCs: "+Math.round(r/1e9).toLocaleString("en-US")+"B / "+n+"%"),$("#rcpower").prop("title","Current Mana:\n"+r.toLocaleString("en-US")+"\nMaximum Mana:\n"+a.toLocaleString("en-US")),setTimeout(o,6e4)})}();var c=new Array,u=0,M=100;function F(e){0<e&&e<100&&(M=e),steem.api.getAccountHistory(p,e,M,function(e,t){c=t.concat(c);var a=new Date;a.setUTCHours(0,0,0,0),a.setDate(a.getDate()-1),a<x(t[0][1].timestamp)&&t[0][0]>u?(M+=50,F(t[0][0]-1)):("Loading..."==$("#latestvotes li:first").text()&&$("#latestvotes").empty(),c.forEach(function(e){var t,a,r,n,o;e[0]>u&&("vote"==e[1].op[0]&&e[1].op[1].author==p&&(t=e[1].op[1].voter,a=e[1].op[1].weight,r=e[1].op[1].permlink,n=e[1].timestamp,o=x(n),$("#latestvotes").prepend("<li><time class='timeago' datetime='"+n+"Z' title='"+o.toLocaleTimeString()+"'></time><a href='#' class='linkaccount' data-account='"+t+"'>"+t+"</a> ("+a/100+"%) upvote <i>"+r+"</i></li>"),$("#latestvotes li").slice(30).remove(),k($("#latestvotes li:first"))),"curation_reward"==e[1].op[0]&&e[1].op[1].curator==p&&l("curation",new Array(0,0,e[1].op[1].reward),e[1].op[1].comment_author,e[1].op[1].comment_permlink,e[1].timestamp),"author_reward"==e[1].op[0]&&e[1].op[1].author==p&&l("author",new Array(e[1].op[1].sbd_payout,e[1].op[1].steem_payout,e[1].op[1].vesting_payout),e[1].op[1].author,e[1].op[1].permlink,e[1].timestamp))}),timeago().render($(".timeago"),"en_short"),u=c[c.length-1][0],M=1,c=[],setTimeout(F,1e4,-1),"Loading..."==$("#latestposts li:first").text()&&0==E&&C(null,null))})}var E=0;function C(e,r){if(0==E){E=1;var g=0,d=null,f=$("select[name='frm_filter_section']").val(),t={created:"getDiscussionsByCreated",hot:"getDiscussionsByHot",trending:"getDiscussionsByTrending",feed:"getDiscussionsByFeed",comments:"getDiscussionsByComments",blog:"getDiscussionsByBlog",userblog:"getDiscussionsByBlog"}[f],h="",a={limit:50};"feed"!=f&&"blog"!=f||(h=p),"userblog"==f&&(h=$("input[name='frm_filter_username']").val(),a.limit=100),"created"==f&&(a.limit=100),"comments"==f&&(a.start_author=p),e&&(a.start_author=e),r&&(a.start_permlink=r),"comments"!=f&&(a.tag=h),steem.api[t](a,function(e,t){if(e)"userblog"==f?$("#latestposts").empty().append("<li>Enter a valid username and optional tag and click the refresh icon...</li>"):$("#latestposts").empty().append("<li>Error while loading data. Please try again...</li>"),E=0;else{if("Loading..."==$("#latestposts li:first").text()&&$("#latestposts").empty(),r&&t.shift(),t.forEach(function(e){if(("1970-01-01T00:00:00"==e.last_payout||"1969-12-31T23:59:59"==e.last_payout||"userblog"==f)&&(("blog"==f||"userblog"==f)&&e.author==h||"blog"!=f&&"userblog"!=f)){var t=JSON.parse(e.json_metadata);if(""==$("input[name='frm_filter_tag']").val()||"userblog"==f&&0<=jQuery.inArray($("input[name='frm_filter_tag']").val().toLowerCase(),t.tags)||"userblog"!=f){var a=S(e.author_reputation,0),r=parseFloat(e.pending_payout_value.replace(" SBD","")),n=r+parseFloat(e.total_payout_value.replace(" SBD",""))+parseFloat(e.curator_payout_value.replace(" SBD","")),o=parseFloat($("input[name='frm_filter_payout']").val());""==e.title&&(e.title=e.body,100<e.title.length&&(e.title=e.title.substring(0,100)+"...")),("userblog"==f||a>=$("input[name='frm_filter_minrep']").val()&&("lt"==$("select[name='frm_filter_payoutlg']").val()&&r<=o||"gt"==$("select[name='frm_filter_payoutlg']").val()&&o<=r))&&(i=e.author,s=a,l=e.title,c=e.created,u=n.toFixed(2),p=e.url,m=x(c),$("#latestposts").append("<li><time class='timeago' datetime='"+c+"Z' title='"+m.toLocaleString()+"'></time><span style='font-size:13px'>$"+u+" |</span> <a href='https://steemit.com/@"+i+"' target='_blank'>"+i+"</a> <span style='font-size:13px;margin-right:6px'>("+s+")</span><i><a href='https://steemit.com"+p+"' target='_blank' style='color:inherit'>"+l+"</a></i></li>"),"blog"!=f&&"comments"!=f||(g+=parseFloat(r),null===d&&(d=e.created)))}}var i,s,l,c,u,p,m}),0==$("#latestposts li").length?$("#latestposts").append("<li>No results...</li>"):timeago().render($(".timeago"),"en_short"),(E=0)<g){var a=x(d);a.setDate(a.getDate()+7),$("#latestposts").append("<li><time class='timeago' datetime='"+a+"' title='"+a.toLocaleString()+"'></time><span style='font-size:13px'>$"+g.toFixed(2)+" | Total pending rewards</span></li>"),timeago().render($(".timeago"),"en_short")}if("created"==f)(new Date-x(t[t.length-1].created))/1e3<3600&&C(t[t.length-1].author,t[t.length-1].permlink)}})}}function B(e){var t=$("select[name='frm_filter_section']").val();"userblog"==t?($("#filterfields12").hide(),$("#filterfields34").show(),""==$("input[name='frm_filter_username']").val()&&$("input[name='frm_filter_username']").val(p)):(b("filter_section",t),b("filter_minrep",$("input[name='frm_filter_minrep']").val()),b("filter_payoutlg",$("select[name='frm_filter_payoutlg']").val()),b("filter_payout",$("input[name='frm_filter_payout']").val()),$("#filterfields34").hide(),$("#filterfields12").show()),$("#latestposts").empty().append("<li>Loading...</li>"),C(null,null),e.preventDefault()}function I(t,a){$.ajaxSetup({cache:!0}),$.getScript("https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.min.js").done(function(){a.datasets[0].backgroundColor="light"==r?"rgba(97, 205, 255, 0.7)":"rgba(26, 80, 136, 0.7)";var e=document.getElementById("chartRewards").getContext("2d");n&&n.destroy(),n=new Chart(e,{type:t,data:a,options:{responsive:!0,maintainAspectRatio:!1,scales:{xAxes:[{gridLines:{color:"rgba(90, 90, 90, 0.1)"},ticks:{fontSize:10,callback:function(e){return e.substr(e.indexOf("_")+1)}}}],yAxes:[{gridLines:{color:"rgba(90, 90, 90, 0.1)"}}]}}}),$("#chartRewardsContainer").slideDown()})}$("#form_filter").on("change",B),$("#form_filter_refresh").on("click",B),$("#form_settings").on("submit",function(e){b("myaccount",p=$("input[name='frm_username']").val()),b("theme",$("select[name='frm_theme']").val()),b("node",$("select[name='frm_node']").val()),window.location="/@"+p,e.preventDefault()}),$("#chartIcon").on("click",function(e){I("bar",{labels:Object.keys(y),datasets:[{label:"Curation Rewards in SP",data:Object.keys(y).map(function(e){return y[e]}),borderColor:"rgba(54, 156, 215, 0.7)",borderWidth:1}]}),e.preventDefault()}),$("#link_price").on("click",function(e){steem.api.getFeedHistory(function(e,t){var a=[],r=new Date;r.setDate(r.getDate()-3.5),t.price_history.forEach(function(e){30<r.getMinutes()&&r.setHours(r.getHours()+1);var t=r.getDate()+"_"+r.getHours()+":30";a[t]=e.base.replace(" SBD",""),r.getMinutes()<=30&&r.setHours(r.getHours()+1)}),I("line",{labels:Object.keys(a),datasets:[{label:"STEEM price",data:Object.keys(a).map(function(e){return a[e]}),borderColor:"rgba(54, 156, 215, 0.7)",borderWidth:1},{type:"line",label:"Median / Feed price",backgroundColor:"rgba(0,200,137, 0.2)",borderColor:"rgba(0,200,137, 1)",fill:!1,borderWidth:1,data:[{x:0,y:d},{x:Object.keys(a)[Object.keys(a).length-1],y:d}]}]})}),e.preventDefault()}),$("#closeChart").on("click",function(e){$("#chartRewardsContainer").slideUp(),e.preventDefault()}),$(".seen").on("click",function(e){$($(this).attr("href")).empty(),e.preventDefault()}),$("#range_vote_weight").on("input",function(){$("#vote_weight").text($(this).val())}),$("#range_vote_weight").on("change",function(){T()}),steem.api.getDynamicGlobalProperties(function(e,t){e?(console.log(e),$("#latestvotes").empty().append("<li>WebSocket connection to 'https://"+a+"' failed...<br>Try to connect to another API node.</li>")):(m=t.total_vesting_fund_steem.replace(" STEEM","")/t.total_vesting_shares.replace(" VESTS",""),T(),F(-1))}),function e(){steem.api.getRewardFund("post",function(e,t){g=t.reward_balance.replace(" STEEM","")/t.recent_claims}),steem.api.getCurrentMedianHistoryPrice(function(e,t){d=t.base.replace(" SBD","")/t.quote.replace(" STEEM",""),$("#steem_price_sbd").text(d.toFixed(2))}),steem.api.getDiscussionsByBlog({tag:"penguinpablo",limit:1},function(e,t){$("#penguinpablo_latestpost").text(t[0].title),$("#penguinpablo_latestpost").attr("href","https://steemit.com"+t[0].url)}),setTimeout(e,3e5)}()});